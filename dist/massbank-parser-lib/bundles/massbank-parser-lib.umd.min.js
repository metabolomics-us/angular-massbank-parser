!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@angular/core"),require("ngx-logger")):"function"==typeof define&&define.amd?define("massbank-parser-lib",["exports","@angular/core","ngx-logger"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self)["massbank-parser-lib"]={},e.ng.core,e.i1)}(this,(function(e,n,r){"use strict";var t=function(e){var n=this;this.logger=e,this.convertWithCallback=function(e,r){var t=function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};function o(e,n,r){null!=n&&(n=t(n));var o=/(\w+[\/]*\w)\s(.+)/.exec(e);if(null!=o){var a=t(o[1].toLowerCase());if("FOCUSED_ION"==n&&(n="MASS_SPECTROMETRY"),"retention_time"==a){var s=/([0-9]+\.?[0-9]+).*min.*/;s.test(o[2])?r.meta.push({name:a,value:t(s.exec(o[2])[1]),category:n}):r.meta.push({name:a,value:t(o[2]),category:n})}if("precursor_m/z"==a)for(var i=/([0-9]+\.?[0-9]+)/g,c=i.exec(o[2]);null!=c;)r.meta.push({name:"precursor m/z",value:t(c[1]),category:n}),c=i.exec(o[2]);else r.meta.push({name:a,value:t(o[2]),category:n})}}for(var a,s={names:[],meta:[],inchi:"",comments:"",accurate:!0,spectrum:""},i=/\s*(\S+):\s(.+)\s/g,c=/\s\s(\d+\.?\d*)(?:\s\d+)?\s+.*(\[.+\][\+\-]?(?:\(.+\))?).*/g,l=e.toString("utf8");null!=(a=i.exec(l));)if("PK$PEAK"===a[1]||"PK$NUM_PEAK"===a[1]||"CH$SMILES"===a[1]||"CH$FORMULA"===a[1]||"RECORD_TITLE"===a[1]||"DATE"===a[1]);else if("CH$NAME"===a[1])s.names.push(t(a[2]));else if("PK$ANNOTATION"===a[1])for(;null!=(a=c.exec(e));)s.meta.push({category:"annotation",name:t(a[2]),value:t(a[1])});else if("CH$IUPAC"==a[1]||"CH$INCHI"==a[1])if(a[2]=t(a[2]),a[2].indexOf("InChI=")>-1){var u=a[2].indexOf("InChI=");u=a[2].indexOf("InChI=",u+1),s.inchi=u>-1?t(a[2].substring(u)):a[2]}else s.names.push(a[2]);else"COMMENT"==a[1]?s.comments=t(a[2]):a[1].indexOf("LINK")>-1||"AC$MASS_SPECTROMETRY"===a[1]||"AC$CHROMATOGRAPHY"===a[1]||"MS$FOCUSED_ION"==a[1]||"MS$DATA_PROESSING"==a[1]?o(a[2],a[1],s):s.meta.push({name:t(a[1]),value:t(a[2])});for(var f=/^(?:[a-zA-Z\s])*\$(.*)$/i,g=0;g<s.meta.length;g++){var d=s.meta[g];f.test(d.name)&&(d.name=f.exec(d.name)[1]),null!=d.category&&f.test(d.category)&&(d.category=f.exec(d.category)[1])}for(var m=/\s\s((?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)\s((?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)\s(\d+)\b/g,p=/([0-9]*\.?[0-9]{3,})/,v=[],h=!1;null!=(a=m.exec(l));)a[1].toLowerCase().indexOf("e")>-1&&(a[1]=parseFloat(a[1]).toString()),a[2].toLowerCase().indexOf("e")>-1&&(a[2]=parseFloat(a[2]).toString()),a[3].toLowerCase().indexOf("e")>-1&&(a[3]=parseFloat(a[3]).toString()),a[2]>0&&(h=!0),v.push([a[1],a[2],a[3]]),p.test(a[1])||(s.accurate=!1);for(g=0;g<v.length;g++)v[g]=h?v[g][0]+":"+v[g][1]:v[g][0]+":"+v[g][2];s.spectrum=v.join(" "),v.length&&s.names.length?r(s):n.logger.warn("was no able to find valid spectra for record:\n\n"+e+"\n\n build object was:\n\n"+JSON.stringify(s))},this.convertFromData=function(e,r){return n.convertWithCallback(e,r)},this.countSpectra=function(e){for(var n=0,r=-1;-1!=(r=e.indexOf("PK$NUM_PEAK",r+1));)n++;return n<=1?n:0}};t.ɵfac=function(e){return new(e||t)(n.ɵɵinject(r.NGXLogger))},t.ɵprov=n.ɵɵdefineInjectable({token:t,factory:t.ɵfac,providedIn:"root"});var o=function(){};o.ɵmod=n.ɵɵdefineNgModule({type:o}),o.ɵinj=n.ɵɵdefineInjector({factory:function(e){return new(e||o)},providers:[t],imports:[[r.LoggerModule.forRoot({level:r.NgxLoggerLevel.DEBUG,serverLogLevel:r.NgxLoggerLevel.OFF})]]}),("undefined"==typeof ngJitMode||ngJitMode)&&n.ɵɵsetNgModuleScope(o,{imports:[r.LoggerModule]}),e.MassbankParserLibModule=o,e.MassbankParserLibService=t,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=massbank-parser-lib.umd.min.js.map